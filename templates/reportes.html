{% extends "base.html" %}

{% block title %}Reportes - Sistema de Gestión Mis Angeles{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2 class="mb-4">
            <i class="bi bi-graph-up"></i> Reportes y Estadísticas
        </h2>
    </div>
</div>

<!-- Tarjetas de resumen -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card stats-card">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h6 class="card-title">Total Productos</h6>
                        <h3 class="mb-0">{{ total_productos }}</h3>
                    </div>
                    <div class="align-self-center">
                        <i class="bi bi-boxes fs-1"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card stats-card">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h6 class="card-title">Ventas del Mes</h6>
                        <h3 class="mb-0">{{ ventas_mes }}</h3>
                    </div>
                    <div class="align-self-center">
                        <i class="bi bi-cart-check fs-1"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card stats-card">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h6 class="card-title">Total Ventas USD</h6>
                        <h3 class="mb-0">${{ "%.2f"|format(total_ventas_usd) }}</h3>
                    </div>
                    <div class="align-self-center">
                        <i class="bi bi-currency-dollar fs-1"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card stats-card">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h6 class="card-title">Total Ventas BS</h6>
                        <h3 class="mb-0">Bs {{ "%.2f"|format(total_ventas_bs) }}</h3>
                    </div>
                    <div class="align-self-center">
                        <i class="bi bi-currency-exchange fs-1"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Opciones de reportes -->
<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-download"></i> Exportar Reportes
                </h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-3">
                    <a href="{{ url_for('exportar_excel') }}" class="btn btn-success">
                        <i class="bi bi-file-earmark-excel"></i> Exportar Inventario a Excel
                    </a>
                    <button class="btn btn-primary" onclick="exportarVentas()">
                        <i class="bi bi-file-earmark-text"></i> Reporte de Ventas
                    </button>
                    <button class="btn btn-info" onclick="exportarEntradas()">
                        <i class="bi bi-file-earmark-text"></i> Reporte de Entradas
                    </button>
                    <button class="btn btn-warning" onclick="exportarResumen()">
                        <i class="bi bi-file-earmark-text"></i> Resumen General
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-calendar"></i> Filtros de Fecha
                </h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="fechaInicio" class="form-label">Fecha de Inicio</label>
                    <input type="date" class="form-control" id="fechaInicio">
                </div>
                <div class="mb-3">
                    <label for="fechaFin" class="form-label">Fecha de Fin</label>
                    <input type="date" class="form-control" id="fechaFin">
                </div>
                <div class="d-grid">
                    <button class="btn btn-outline-primary" onclick="aplicarFiltros()">
                        <i class="bi bi-funnel"></i> Aplicar Filtros
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Gráficos y estadísticas -->
<div class="row mt-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-pie-chart"></i> Ventas por Categoría
                </h5>
            </div>
            <div class="card-body">
                <div class="text-center py-4">
                    <i class="bi bi-pie-chart fs-1 text-muted"></i>
                    <h6 class="text-muted mt-3">Gráfico de Ventas por Categoría</h6>
                    <p class="text-muted small">Función en desarrollo</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-graph-up"></i> Ventas por Día
                </h5>
            </div>
            <div class="card-body">
                <div class="text-center py-4">
                    <i class="bi bi-graph-up fs-1 text-muted"></i>
                    <h6 class="text-muted mt-3">Gráfico de Ventas por Día</h6>
                    <p class="text-muted small">Función en desarrollo</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Tabla de productos más vendidos -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-trophy"></i> Productos Más Vendidos
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Posición</th>
                                <th>Producto</th>
                                <th>Código</th>
                                <th>Unidades Vendidas</th>
                                <th>Total USD</th>
                                <th>Total BS</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for i in range(1, 6) %}
                            <tr>
                                <td>
                                    <span class="badge bg-primary">#{{ i }}</span>
                                </td>
                                <td>
                                    <strong>Producto {{ i }}</strong>
                                </td>
                                <td>
                                    <span class="badge bg-secondary">P{{ "%03d"|format(i) }}</span>
                                </td>
                                <td>
                                    <span class="badge bg-success">{{ i * 10 }}</span>
                                </td>
                                <td>
                                    <strong>${{ "%.2f"|format(i * 1.50) }}</strong>
                                </td>
                                <td>
                                    <strong>Bs {{ "%.2f"|format(i * 53.25) }}</strong>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Resumen de movimientos -->
<div class="row mt-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-arrow-down-circle"></i> Últimas Entradas
                </h5>
            </div>
            <div class="card-body">
                <div class="text-center py-4">
                    <i class="bi bi-arrow-down-circle fs-1 text-muted"></i>
                    <h6 class="text-muted mt-3">Historial de Entradas</h6>
                    <p class="text-muted small">Función en desarrollo</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-arrow-up-circle"></i> Últimas Ventas
                </h5>
            </div>
            <div class="card-body">
                <div class="text-center py-4">
                    <i class="bi bi-arrow-up-circle fs-1 text-muted"></i>
                    <h6 class="text-muted mt-3">Historial de Ventas</h6>
                    <p class="text-muted small">Función en desarrollo</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Establecer fechas por defecto (último mes)
    document.addEventListener('DOMContentLoaded', function() {
        const hoy = new Date();
        const haceUnMes = new Date(hoy.getFullYear(), hoy.getMonth() - 1, hoy.getDate());
        
        document.getElementById('fechaInicio').value = haceUnMes.toISOString().split('T')[0];
        document.getElementById('fechaFin').value = hoy.toISOString().split('T')[0];
    });
    
    // Exportar reporte de ventas
    function exportarVentas() {
        const fechaInicio = document.getElementById('fechaInicio').value;
        const fechaFin = document.getElementById('fechaFin').value;
        
        if (!fechaInicio || !fechaFin) {
            alert('Por favor, selecciona las fechas de inicio y fin.');
            return;
        }
        
        // Por ahora, mostrar mensaje
        alert('Función de exportación de ventas en desarrollo.\n\n' +
              'Fechas seleccionadas:\n' +
              'Inicio: ' + fechaInicio + '\n' +
              'Fin: ' + fechaFin);
    }
    
    // Exportar reporte de entradas
    function exportarEntradas() {
        const fechaInicio = document.getElementById('fechaInicio').value;
        const fechaFin = document.getElementById('fechaFin').value;
        
        if (!fechaInicio || !fechaFin) {
            alert('Por favor, selecciona las fechas de inicio y fin.');
            return;
        }
        
        alert('Función de exportación de entradas en desarrollo.\n\n' +
              'Fechas seleccionadas:\n' +
              'Inicio: ' + fechaInicio + '\n' +
              'Fin: ' + fechaFin);
    }
    
    // Exportar resumen general
    function exportarResumen() {
        const fechaInicio = document.getElementById('fechaInicio').value;
        const fechaFin = document.getElementById('fechaFin').value;
        
        if (!fechaInicio || !fechaFin) {
            alert('Por favor, selecciona las fechas de inicio y fin.');
            return;
        }
        
        alert('Función de exportación de resumen en desarrollo.\n\n' +
              'Fechas seleccionadas:\n' +
              'Inicio: ' + fechaInicio + '\n' +
              'Fin: ' + fechaFin);
    }
    
    // Aplicar filtros de fecha
    function aplicarFiltros() {
        const fechaInicio = document.getElementById('fechaInicio').value;
        const fechaFin = document.getElementById('fechaFin').value;
        
        if (!fechaInicio || !fechaFin) {
            alert('Por favor, selecciona las fechas de inicio y fin.');
            return;
        }
        
        if (fechaInicio > fechaFin) {
            alert('La fecha de inicio no puede ser mayor que la fecha de fin.');
            return;
        }
        
        // Por ahora, mostrar mensaje
        alert('Filtros aplicados:\n' +
              'Fecha de inicio: ' + fechaInicio + '\n' +
              'Fecha de fin: ' + fechaFin + '\n\n' +
              'Los reportes se actualizarán con estos filtros.');
    }
    
    // Formatear números automáticamente
    document.addEventListener('DOMContentLoaded', function() {
        const usdElements = document.querySelectorAll('strong');
        usdElements.forEach(element => {
            if (element.textContent.includes('$')) {
                const value = parseFloat(element.textContent.replace('$', ''));
                if (!isNaN(value)) {
                    element.textContent = '$' + value.toLocaleString('es-VE', {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    });
                }
            }
        });
    });
</script>
{% endblock %}
